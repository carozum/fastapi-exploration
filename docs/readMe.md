 https://aka.ms/PWA-Series 
https://www.youtube.com/live/95Qwsi5cs78 
Video Pamela Fox FastAPI

Repos used : 
aka.ms/python-web-apps-fastapi
aka.ms/fastapi-starter
aka.ms/fastapi-postgres-app
aka.ms/fastapi-azure-functions
aka.ms/fastapi-functions-apim

pip install -r requirements.txt

# HTTP HyperText Transfer Protocol
This is what the web is built on 
- A client sends an HTTP request
- A server sends back an HTTP response. 

> inspect (dev tools in browser) > Network tab > all : to see all the requests that were made to load the page. 

## Action verb
- GET : retrieve data from a server (the client wants to get the web page)
- POST : send data to a server
- PUT : send data to a server, replacing existing data 
- PATCH : send data to a server, updating part of existing data 
- DELETE : delete data from a server

## HTTP Status code
- 200 successful
- 301 moved permanently (redirection)
- 401 not authorized
- 404 not found
- 500 Server error

# HTTP API

## API vs HTTP API

*API* = Application programming interface. 
A way for a program to talk to another program. 
Not all APIs are HTTP APIs 

*HTTP API* = any API that uses HTTP as its communication protocol. (a computer sends an HTTP request and another computer sends back an HTTP response, a program to another program).
![HTTP APIs](image.png)

## HTTP API response formats
- JSON
- XML
- image
![HTTP API response format](image-1.png)

## HTTP APIs : GET vs. POST
- *GET* : retrieve data from a server. Often used with query parameters
- *POST* : send data to a server. Data is often in Json or for-encoded.(ex: google spreadsheet, the user sends data to the server). Will need some sort of authentication to know that it is OK for us to do such thing. 

## with python
package *requests* builtin package often used. Another one is used in the first example : urllib3

## Popular APIs : 
- social media: reddit, twitter, facebook Graph, instagram,
- productivity software : google workspace, microsoft graph, 
- non user data : google maps geocoding, amazon products, the movie DB, Openweather

## internal APIs
An API can also be setup solely for use by the company that made it. 
Many web sites have a separate codebase for their frontend and backend and all the communication happens over internal APIs. 
Internal APIs should still be documented and easy to use. 


## first example of calls to external APIs
pip install urllib3 rich
test-urllib3.py


# Building an HTTP API with FastAPI

FastAPI is a python framework designed specifically for building HTTP APIs. 
- fast to build and fast to execute, built on async instead of sync
- relies on python types (via pydantic)
- auto-generated documentation via swagger-UI
- based on the openAI specification. 
s
fastapi app are by default async. An all the routes of the API are async functions. An async function is also known as a coroutine. It is very important for enabling concurrency meaning that when we are running our async app, it is easier ofr a server to handle multiple users because, it can pause while it is doing like some IO and then it can handle another user. 
The function is decorated with the name of the app, the verb (get) and the route. 


in development environment : 
- fastapi dev scripts/test-fastapi-simple.py
- http://127.0.0.1:8000/generate_name api
- http://127.0.0.1:8000/docs auto generated documentation

in production mode : 
- fastapi run

![fastapi autogenerated documentation](image-2.png)
test > try it out > execute : it is using the swagger UI documentation

## adding a parameter

when adding a parameter, you need to add a type annotation because fastapi is built on type annotations ! Also need to precise if the parameter is optional. Needed to do API validation and API documentation. 

## using get or post
Get is OK for public information as the parameters are passed in the URL
--> parameters are in the fonction definition parameters
--> request URL : http://127.0.0.1:8000/generate_name_2?starts_with=m&min_length=7  

post is better for sensitive data as the parameter are passed in the body of the request. For a chat for example, the route should be a post as we don't want the conversation with the user to be public. 
--> parameters are in the request body
![request URL post](image-3.png)
--> request URL : http://127.0.0.1:8000/generate_name_2
--> request body : {"starts_with":"m", "min_length":7}

If there is any doubt, use post. 


# Productionizing FastAPI apps
For production, you'll need a server that can handle : 
- handle ASGI (async) apps
- process multiple requests concurrently

Options : 
- Gunicorn (WSGI + ASGI*)
- uvicorn (ASGI only)
- Hypercorn (ASGI only)

## Uvicorn
Uvicorn is a production level server specifically for Asgi apps. As of version 0.30.0 uvicorn can handle multiple workers. 
- add :  uvicorn[standard] to requirements.txt 
- and run : uvicorn scripts.test-fastapi-simple:app --workers 4 --port 8000


# Best practices
Cool library
rich library to print the result of a JSON
rich.print(response) # formats all the JSON